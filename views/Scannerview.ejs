<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Add a CSS animation for scanning effect */
        @keyframes scanning {
            0% { top: 0; }
            50% { top: 100%; }
            100% { top: 0; }
        }
        
        .container {
            position: relative;
        }

        .scan-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #007bff; /* Adjust the color as needed */
            animation: scanning 3s linear infinite;
            z-index: 2; /* Ensure the scan bar is above the video */
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1); /* Add shadow */
        }

        video {
            position: relative; /* Make sure the video is also relative */
            z-index: 1; /* Set the video behind the scan bar */
        }

        /* Style the scanned QR code output */
        #output {
            margin-top: 20px;
            text-align: start;
            font-size: 18px;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="h-20 flex justify-center items-center bg-amber-400 rounded-b-lg h-12 text-2xl font-medium leading-tight text-gray-600">
        <h5>OUTPASS SCANNER</h5>
    </div>
    <div class="container mx-auto p-4 relative">
        <div class="flex justify-center">
            <div class="w-full max-w-lg bg-white p-4 rounded-lg shadow-lg relative">
                <!-- Add the scanning animation bar -->
                <div class="scan-bar"></div>
                <video id="scanner" class="w-full" style="max-width: 100%;"></video>
            </div>
        </div>
        <div id="output" class="mt-4 text-center text-xl font-semibold"></div>
    </div>
    <div class="flex justify-center text-center rounded">
        <a href="" class="h-6 w-12 bg-green-500 done-link">Done</a>

    </div>

    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script>
        // Initialize Instascan and get access to the user's camera
        const scanner = new Instascan.Scanner({ video: document.getElementById('scanner') });

        // Listen for the "scan" event
        scanner.addListener('scan', function (content) {
            // Parse the JSON content
            const parsedContent = JSON.parse(content);
            console.log(parsedContent);
            // Format date and time to local format
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                timeZoneName: 'short' 
            };
            const dateTimeOut = new Date(parsedContent.DateTimeOut).toLocaleString(undefined, options);
            const dateTimeIn = new Date(parsedContent.DateTimeIn).toLocaleString(undefined, options);

            // Create formatted output
            const formattedOutput = `
                <div>
                    <h2 class="text-2xl font-semibold mb-2">Scanned QR Code Details</h2>
                    <p><strong>Student Name:</strong> ${parsedContent.StudentName}</p>
                    <p><strong>College:</strong> ${parsedContent.College}</p>
                    <p><strong>Mobile:</strong> ${parsedContent.Mobile}</p>
                    <p><strong>Current Year:</strong> ${parsedContent.CurrentYear}</p>
                    <p><strong>DateTime Out:</strong> ${dateTimeOut}</p>
                    <p><strong>DateTime In:</strong> ${dateTimeIn}</p>
                </div>
            `;
            
            document.getElementById('output').innerHTML = formattedOutput;
            const doneLink = document.querySelector('.done-link');
    if (doneLink) {
        doneLink.href = `/scanned/${parsedContent.outpassId}`;
    }
        });

        // Start scanning
        Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
                scanner.start(cameras[0]); // Use the first available camera
            } else {
                console.error('No cameras found.');
            }
        }).catch(function (error) {
            console.error(error);
        });
        
    </script>
</body>
</html>
